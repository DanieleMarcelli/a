<!DOCTYPE html>
<html lang="it" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rendiconto di Mandato | Avigliano Umbro 2027</title>
    <meta name="description" content="Rendiconto di mandato 2022-2027. Confronto tra programma elettorale e risultati concreti.">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Avigliano Umbro: Promesse Mantenute">
    <meta property="og:description" content="Esplora il confronto tra il programma 2021 e i risultati 2027.">
    <meta property="og:image" content="https://images.unsplash.com/photo-1449824913929-4bd52643881a?q=80&w=1200">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Manrope:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,600;0,700;1,600&display=swap" rel="stylesheet">
    
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'brand-blue': 'var(--color-primary)', 
                        'brand-dark': 'var(--color-dark)',
                        'brand-accent': 'var(--color-accent)',
                        'area-social': '#3b82f6',
                        'area-culture': '#10b981',
                        'area-works': '#d97706',
                        'area-env': '#f97316',
                        'area-admin': '#64748b'
                    },
                    fontFamily: {
                        sans: 'var(--font-body)',
                        serif: 'var(--font-heading)',
                    },
                    borderRadius: { 'theme': 'var(--radius-theme)' },
                    boxShadow: { 'theme': 'var(--shadow-theme)' }
                }
            }
        }
    </script>

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollToPlugin.min.js"></script>

    <style>
        :root {
            /* THEME: CLASSIC (Default) */
            --color-primary: #004aad;
            --color-dark: #0a192f;
            --color-accent: #fbbf24;
            --font-heading: 'Playfair Display', serif;
            --font-body: 'Manrope', sans-serif;
            --radius-theme: 0.75rem; 
            --shadow-theme: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        body.theme-modern {
            --color-primary: #2563eb;
            --color-dark: #1e293b;
            --color-accent: #60a5fa;
            --font-heading: 'Inter', sans-serif;
            --font-body: 'Inter', sans-serif;
            --radius-theme: 0px;
            --shadow-theme: none;
            background-color: #ffffff;
        }

        body.theme-energetic {
            --color-primary: #1d4ed8;
            --color-dark: #000000;
            --color-accent: #facc15;
            --font-heading: 'Manrope', sans-serif;
            --font-body: 'Manrope', sans-serif;
            --radius-theme: 1.5rem;
            --shadow-theme: 5px 5px 0px rgba(0,0,0,1);
        }

        body {
            background-color: #f8fafc;
            color: #334155;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* ADMIN INTERACTIVE MODE */
        body.admin-mode .admin-selectable {
            position: relative;
            cursor: pointer;
            border: 2px solid transparent;
        }
        body.admin-mode .admin-selectable:hover {
            border: 2px dashed #fbbf24;
            background-color: rgba(251, 191, 36, 0.05);
        }
        body.admin-mode .admin-selectable::after {
            content: "‚úé Modifica";
            position: absolute;
            top: 10px; right: 10px;
            background: #fbbf24; color: #000;
            font-size: 10px; font-weight: bold;
            padding: 4px 8px; border-radius: 4px;
            opacity: 0; pointer-events: none; z-index: 50;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        body.admin-mode .admin-selectable:hover::after { opacity: 1; }
        
        /* UI COMPONENTS */
        .glass-card {
            background: white;
            border: 1px solid #e2e8f0;
            box-shadow: var(--shadow-theme);
            border-radius: var(--radius-theme);
            transition: all 0.3s ease;
            transform-style: preserve-3d;
        }
        body.theme-energetic .glass-card { border: 2px solid #000; }
        .glass-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }

        .comparison-wrapper { position: relative; width: 100%; height: 100%; overflow: hidden; cursor: ew-resize; user-select: none; }
        .comparison-after { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; }
        .comparison-before { position: absolute; top: 0; left: 0; width: 50%; height: 100%; background-size: cover; background-position: center; border-right: 3px solid white; overflow: hidden; z-index: 10; }
        .comparison-handle { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 32px; height: 32px; background: rgba(255,255,255,0.9); border-radius: 50%; z-index: 20; box-shadow: 0 2px 6px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; pointer-events: none; }

        .map-marker { position: absolute; width: 20px; height: 20px; border: 2px solid white; border-radius: 50%; cursor: pointer; transition: transform 0.3s; z-index: 10; box-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .map-marker:hover { transform: scale(1.5); z-index: 20; }
        .map-popup { position: absolute; bottom: 25px; left: 50%; transform: translateX(-50%); background: white; padding: 6px 10px; border-radius: 6px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); font-size: 0.7rem; white-space: nowrap; display: none; z-index: 30; font-weight: bold; color: var(--color-primary); }
        .map-marker:hover .map-popup { display: block; }

        /* LIST STYLES */
        .check-list li { position: relative; padding-left: 1.5rem; margin-bottom: 0.5rem; font-size: 0.95rem; line-height: 1.5; }
        .check-list li::before { content: '‚úì'; position: absolute; left: 0; color: var(--color-primary); font-weight: bold; }
        
        .promise-list li { position: relative; padding-left: 1.5rem; margin-bottom: 0.5rem; font-size: 0.95rem; line-height: 1.5; color: #64748b; font-style: italic; }
        .promise-list li::before { content: '‚ûî'; position: absolute; left: 0; color: #94a3b8; }

        #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: white; color: #1e293b; padding: 12px 16px; border-radius: 8px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border-left: 4px solid var(--color-primary); font-size: 0.875rem; font-weight: 600; animation: slideIn 0.3s ease-out forwards; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body class="antialiased font-sans theme-classic">

    <!-- UTILS -->
    <div id="toast-container"></div>
    <div id="scroll-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="fixed bottom-8 right-8 z-40 bg-brand-blue text-white p-3 rounded-full shadow-lg hover:bg-opacity-90 hover:-translate-y-1 transform transition-all cursor-pointer opacity-0 pointer-events-none">‚Üë</div>

    <!-- ADMIN SIDEBAR -->
    <div id="admin-dashboard" class="fixed inset-y-0 right-0 w-full md:w-[450px] bg-white shadow-2xl z-[200] transform translate-x-full transition-transform duration-300 flex flex-col border-l border-gray-200">
        <div class="bg-brand-dark text-white p-4 flex justify-between items-center shadow-md shrink-0">
            <div><h2 class="font-bold text-lg text-brand-accent">‚öôÔ∏è Pannello Admin</h2><p class="text-[10px] text-gray-400">Modalit√† Modifica Attiva</p></div>
            <button onclick="Admin.toggle()" class="text-white hover:text-gray-300">‚úï</button>
        </div>
        
        <!-- DYNAMIC CONTEXTUAL EDITOR -->
        <div id="admin-context-editor" class="flex-1 overflow-y-auto p-6 bg-slate-50 relative">
            <div id="admin-default-view" class="text-center mt-10 opacity-50">
                <p class="text-4xl mb-2">üëÜ</p>
                <p class="text-sm font-bold">Clicca su una sezione del sito<br>per modificarla qui.</p>
                <div class="mt-10 border-t pt-10">
                    <p class="text-xs font-bold uppercase mb-4 text-left">Impostazioni Generali:</p>
                    <button onclick="Admin.loadSectionEditor('design')" class="w-full bg-white border border-gray-200 p-3 rounded mb-2 hover:bg-blue-50 font-bold text-sm text-left shadow-sm flex items-center gap-2">üé® Layout & Tema</button>
                    <button onclick="Admin.exportData()" class="w-full bg-gray-800 text-white p-3 rounded mt-4 font-bold text-sm">üíæ Backup Dati (JSON)</button>
                    <button onclick="Admin.resetData()" class="w-full text-red-500 p-3 rounded mt-2 text-xs hover:bg-red-50">‚ö†Ô∏è Ripristina Dati Iniziali</button>
                </div>
            </div>
            <div id="admin-dynamic-form" class="hidden space-y-4">
                <!-- Form generated by JS -->
            </div>
        </div>
    </div>

    <!-- LOGIN MODAL -->
    <div id="login-modal" class="fixed inset-0 z-[250] bg-brand-dark/90 flex items-center justify-center hidden backdrop-blur-md">
        <div class="bg-white p-8 rounded-2xl w-full max-w-sm shadow-2xl text-center">
            <h3 class="text-2xl font-bold mb-2 text-brand-dark">Accesso Staff</h3>
            <p class="text-sm text-gray-500 mb-6">Inserisci la password amministratore</p>
            <input type="password" id="admin-password" placeholder="Password" class="w-full p-3 border rounded-lg mb-4 text-center text-lg outline-none focus:ring-2 focus:ring-brand-blue" onkeyup="if(event.key === 'Enter') Admin.login()">
            <button onclick="Admin.login()" class="w-full bg-brand-blue text-white font-bold py-3 rounded-lg hover:bg-blue-700 shadow-lg transition-colors">ACCEDI</button>
        </div>
    </div>

    <!-- NAVBAR -->
    <nav class="fixed w-full z-50 top-0 bg-white/95 backdrop-blur-md border-b border-gray-200 transition-all duration-300 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center gap-3 cursor-pointer" onclick="window.scrollTo(0,0)">
                    <div class="w-10 h-10 bg-brand-blue rounded-theme flex items-center justify-center text-white font-bold text-xl shadow-lg">A</div>
                    <div class="leading-tight">
                        <span class="block font-bold text-lg tracking-tight text-brand-dark font-serif">AVIGLIANO <span class="text-brand-blue">2027</span></span>
                    </div>
                </div>
                <div class="hidden lg:flex space-x-8 items-center">
                    <a href="#confronto" class="text-gray-600 hover:text-brand-blue font-bold text-sm uppercase font-sans tracking-wide">Promesso vs Fatto</a>
                    <a href="#progetti" class="text-gray-600 hover:text-brand-blue font-bold text-sm uppercase font-sans tracking-wide">Dettagli</a>
                    <a href="#mappa" class="text-gray-600 hover:text-brand-blue font-bold text-sm uppercase font-sans tracking-wide">Mappa</a>
                    <a href="#priorita" class="px-6 py-2.5 bg-brand-blue text-white rounded-full font-bold text-sm hover:bg-brand-dark transition-colors font-sans shadow-lg">Il Futuro</a>
                </div>
                <button onclick="document.getElementById('login-modal').classList.remove('hidden')" class="lg:hidden text-gray-500">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>
            </div>
        </div>
    </nav>

    <!-- SECTION: HERO -->
    <header id="sec-hero" class="relative w-full h-[90vh] min-h-[600px] flex items-center justify-center overflow-hidden bg-brand-dark admin-selectable" onclick="Admin.handleClick('hero')">
        <img id="hero-bg-img" src="" class="absolute inset-0 w-full h-full object-cover opacity-50 mix-blend-overlay will-change-transform" alt="Avigliano Umbro Panorama">
        <div class="absolute inset-0 bg-gradient-to-t from-brand-dark via-brand-blue/30 to-black/40 z-0"></div>
        <div class="relative z-10 container mx-auto px-6 text-center mt-10">
            <div class="inline-block bg-white/10 backdrop-blur-md border border-white/20 rounded-full px-6 py-2 mb-6 animate-fade-in">
                <span class="text-brand-accent font-bold uppercase tracking-widest text-xs">Rendiconto di Mandato 2022‚Äì2027</span>
            </div>
            <h1 id="hero-title" class="font-serif font-bold text-5xl md:text-7xl lg:text-8xl text-white leading-tight mb-6 drop-shadow-2xl"></h1>
            <p id="hero-desc" class="font-sans text-gray-200 text-lg md:text-xl max-w-2xl mx-auto mb-10 font-light leading-relaxed opacity-90"></p>
            <button onclick="gsap.to(window, {duration: 1, scrollTo: '#confronto'})" class="bg-brand-accent text-brand-dark font-bold py-4 px-10 rounded-full shadow-lg hover:scale-105 transition-transform font-sans border-2 border-transparent hover:border-white/20">Esplora i Risultati</button>
        </div>
    </header>

    <!-- SECTION: STATS -->
    <section id="sec-stats" class="relative -mt-20 z-20 px-4 admin-selectable" onclick="Admin.handleClick('stats')">
        <div class="container mx-auto max-w-6xl">
            <div class="bg-white rounded-theme shadow-theme p-8 border border-gray-100 grid grid-cols-2 md:grid-cols-4 gap-8 text-center divide-x divide-gray-100">
                <div class="group"><p class="text-5xl font-bold text-brand-blue mb-2 group-hover:scale-110 transition-transform" id="stat-total">0</p><p class="text-xs text-gray-500 uppercase font-bold tracking-wider">Progetti Totali</p></div>
                <div class="group"><p class="text-5xl font-bold text-green-600 mb-2 group-hover:scale-110 transition-transform" id="stat-completed">0</p><p class="text-xs text-gray-500 uppercase font-bold tracking-wider">Conclusi</p></div>
                <div class="group"><p class="text-5xl font-bold text-amber-600 mb-2 group-hover:scale-110 transition-transform" id="stat-wip">0</p><p class="text-xs text-gray-500 uppercase font-bold tracking-wider">Cantieri Attivi</p></div>
                <div class="group"><p class="text-4xl font-bold text-brand-dark mb-2 group-hover:scale-110 transition-transform" id="stat-money">‚Ç¨0</p><p class="text-xs text-gray-500 uppercase font-bold tracking-wider">Investimenti</p></div>
            </div>
        </div>
    </section>

    <!-- SECTION: CONFRONTO PROGRAMMA VS RISULTATI (CORE) -->
    <section id="confronto" class="py-24 bg-gray-50 admin-selectable" onclick="Admin.handleClick('areas')">
        <div class="container mx-auto px-6 max-w-6xl">
            <div class="text-center mb-16">
                <h2 class="font-serif font-bold text-4xl text-brand-dark mb-4">Promesse vs Realt√†</h2>
                <p class="text-gray-600 max-w-2xl mx-auto text-lg">Un confronto trasparente tra quanto scritto nel Programma Elettorale 2021 e quanto effettivamente realizzato per la comunit√†.</p>
            </div>

            <div id="areas-container" class="space-y-12">
                <!-- Areas generated by JS -->
            </div>
        </div>
    </section>

    <!-- SECTION: CANTIERI IN CORSO (AGOR√Ä) -->
    <section id="cantieri" class="py-20 bg-brand-dark text-white relative overflow-hidden admin-selectable" onclick="Admin.handleClick('ongoing')">
        <div class="absolute inset-0 opacity-10 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-gray-700 via-gray-900 to-black"></div>
        <div class="container mx-auto px-6 relative z-10">
            <div class="flex flex-col md:flex-row gap-12 items-center">
                <div class="md:w-1/2">
                    <div class="inline-block bg-amber-500 text-black text-xs font-bold px-3 py-1 rounded mb-4 animate-pulse">üöß LAVORI IN CORSO</div>
                    <h2 class="font-serif font-bold text-4xl mb-6">Il Futuro Centro Agor√†</h2>
                    <div id="ongoing-container">
                        <!-- Content JS -->
                    </div>
                </div>
                <div class="md:w-1/2 w-full h-80 bg-gray-800 rounded-theme border border-gray-700 flex items-center justify-center relative overflow-hidden group">
                    <img src="https://images.unsplash.com/photo-1503387762-592deb58ef4e?q=80&w=1000" class="absolute inset-0 w-full h-full object-cover opacity-50 group-hover:scale-105 transition-transform duration-700" alt="Cantiere">
                    <div class="relative z-10 text-center">
                        <p class="text-4xl font-bold text-brand-accent mb-2">65%</p>
                        <p class="text-sm text-gray-300 uppercase tracking-widest">Avanzamento Lavori</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION: DETTAGLIO PROGETTI -->
    <section id="progetti" class="py-20 bg-white admin-selectable" onclick="Admin.handleClick('projects')">
        <div class="container mx-auto px-6">
            <div class="flex flex-col md:flex-row justify-between items-end mb-10 gap-4 border-b border-gray-100 pb-6">
                <div>
                    <h2 class="font-serif font-bold text-3xl text-brand-dark mb-2">Esplora i Dettagli</h2>
                    <p class="text-gray-500 font-sans text-sm">Naviga tra le schede tecniche di ogni intervento.</p>
                </div>
                <div class="flex gap-4 w-full md:w-auto">
                    <input type="text" id="search-input" placeholder="Cerca intervento..." class="w-full md:w-64 px-4 py-2 rounded-lg border bg-gray-50 focus:bg-white focus:border-brand-blue outline-none transition-colors text-sm" onclick="event.stopPropagation()">
                </div>
            </div>
            
            <div class="flex flex-wrap gap-2 mb-8 justify-center md:justify-start" id="category-filters" onclick="event.stopPropagation()"></div>

            <div id="view-container" class="min-h-[300px]" onclick="event.stopPropagation()"></div>
        </div>
    </section>

    <!-- SECTION: PROSSIMI PASSI -->
    <section id="futuro" class="py-16 bg-slate-50 border-t border-gray-200 admin-selectable" onclick="Admin.handleClick('future')">
        <div class="container mx-auto px-6 max-w-4xl">
            <h2 class="font-serif font-bold text-3xl text-center text-brand-dark mb-10">Cose su cui lavorare ancora</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="future-container">
                <!-- JS Generated -->
            </div>
        </div>
    </section>

    <!-- SECTION: MAPPA -->
    <section id="mappa" class="py-16 bg-white border-t border-gray-100 admin-selectable" onclick="Admin.handleClick('map')">
        <div class="container mx-auto px-6">
            <h2 class="font-serif font-bold text-3xl text-brand-dark mb-6">Mappa Interventi</h2>
            <div class="relative w-full h-[500px] bg-slate-100 rounded-theme overflow-hidden border border-gray-200 shadow-inner group">
                <div class="absolute inset-0 bg-[url('https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/Umbria_location_map.svg/1200px-Umbria_location_map.svg.png')] bg-cover bg-center opacity-40 grayscale group-hover:grayscale-0 transition-all duration-500"></div>
                <div id="map-markers-container" class="absolute inset-0"></div>
                <div class="absolute bottom-4 left-4 bg-white/90 p-3 rounded shadow text-xs">
                    <div class="flex items-center gap-2 mb-1"><span class="w-3 h-3 rounded-full bg-amber-500"></span> Opere</div>
                    <div class="flex items-center gap-2 mb-1"><span class="w-3 h-3 rounded-full bg-blue-500"></span> Sociale</div>
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-green-500"></span> Cultura</div>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION: TIMELINE CHI SONO -->
    <section id="chi-sono" class="py-20 bg-slate-50 admin-selectable" onclick="Admin.handleClick('timeline')">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12">
                <h2 class="font-serif font-bold text-3xl text-brand-dark">Il mio percorso</h2>
                <div class="w-16 h-1 bg-brand-accent mx-auto mt-4"></div>
            </div>
            <div class="relative max-w-4xl mx-auto">
                <div class="absolute top-1/2 left-0 w-full h-0.5 bg-gray-300 -translate-y-1/2 hidden md:block"></div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center relative z-10" id="timeline-container">
                    <!-- JS Generated -->
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION: PRIORITA -->
    <section id="priorita" class="py-20 bg-brand-blue text-white relative overflow-hidden admin-selectable" onclick="Admin.handleClick('priorities')">
        <div class="container mx-auto px-6 relative z-10 text-center">
            <h2 class="font-serif font-bold text-3xl mb-2">La tua opinione conta</h2>
            <p class="mb-10 text-blue-100">Seleziona le priorit√† per il prossimo mandato.</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 max-w-5xl mx-auto" id="priority-grid"></div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="bg-brand-dark text-white py-12 border-t border-gray-800 text-center md:text-left admin-selectable" onclick="Admin.handleClick('footer')">
        <div class="container mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-6">
            <div>
                <h4 class="font-bold text-2xl font-serif text-brand-accent mb-2">Avigliano Umbro</h4>
                <p class="text-gray-400 text-sm max-w-xs">Lista Civica "Avigliano ‚Äì Prima di Tutto"<br>Rendiconto di fine mandato 2022‚Äì2027</p>
            </div>
            <div class="flex gap-4">
                 <button onclick="event.stopPropagation(); document.getElementById('login-modal').classList.remove('hidden')" class="text-xs text-gray-600 hover:text-white border border-gray-700 px-3 py-1 rounded hover:bg-gray-800 transition-colors">Admin Area</button>
            </div>
        </div>
    </footer>

    <!-- LOGIC -->
    <script>
        const Data = {
            state: {
                theme: 'classic',
                texts: {
                    heroTitle: 'PROMESSE<br><span class="text-brand-accent">MANTENUTE.</span>',
                    heroDesc: 'Cinque anni di amministrazione concreta. Un confronto trasparente tra il programma elettorale e i risultati raggiunti per Avigliano Umbro.',
                    heroImg: 'https://images.unsplash.com/photo-1449824913929-4bd52643881a?q=80&w=2070&auto=format&fit=crop'
                },
                timeline: [
                    { step: 1, title: "Consigliere", year: "2017 - 2022", desc: "L'inizio dell'impegno per le frazioni." },
                    { step: 2, title: "Vice Sindaco", year: "2022 - 2027", desc: "Responsabilit√† e opere pubbliche." },
                    { step: 3, title: "Candidato", year: "2027", desc: "Una nuova visione per Avigliano." }
                ],
                // CORE DATA: COMPARISON PROGRAM VS RESULTS
                areas: [
                    {
                        id: 'sociale', name: 'Politiche Sociali', color: 'bg-blue-50 border-blue-200', titleColor: 'text-blue-700', icon: 'üü¶',
                        promises: "Sostegno alla natalit√† e alla prima infanzia.\nPolitiche di Welfare locale per giovani e famiglie.\nAttenzione alle categorie fragili e terza et√†.",
                        results: "Attivazione servizio educativo 'Borgo 0‚Äì6' a Sismano.\nCorsi su genitorialit√† e adolescenza.\nAmmortizzazione aumenti Scuolabus e Mensa.\nBando case popolari e assegnazioni.\nAvvio Consulta Comunale dei Giovani.\nProgetti di inclusione sociale per anziani."
                    },
                    {
                        id: 'cultura', name: 'Cultura e Turismo', color: 'bg-green-50 border-green-200', titleColor: 'text-green-700', icon: 'üü©',
                        promises: "Rilancio della biblioteca comunale.\nTurismo green e sostenibile.\nValorizzazione Foresta Fossile e Grotta Bella.",
                        results: "Riapertura Biblioteca Bettelli con coworking.\nProgetto 'Il filo della tradizione'.\nSperimentazione Cineforum comunale.\nFesta della Musica ampliata.\nNuova segnaletica turistica QR.\nBando 'Bici in Comune' (80k‚Ç¨)."
                    },
                    {
                        id: 'opere', name: 'Opere Pubbliche', color: 'bg-amber-50 border-amber-200', titleColor: 'text-amber-700', icon: 'üü´',
                        promises: "Manutenzione strade e cura dell'esistente.\nRiqualificazione centri storici e parchi.\nCura dei cimiteri e arredo urbano.",
                        results: "Asfaltatura Via Levi e Via Salvemini.\nStrada del Pergolone e S. Restituta.\nRiqualificazione Piazze Teatro e Comunit√†.\n14 Nuovi parcheggi in centro.\nPotenziamento Parco Piacenti.\nNuovi loculi nei cimiteri."
                    },
                    {
                        id: 'ambiente', name: 'Ambiente', color: 'bg-orange-50 border-orange-200', titleColor: 'text-orange-700', icon: 'üüß',
                        promises: "Introduzione tariffa puntuale (TARIC).\nEfficientamento energetico.\nTutela ambientale.",
                        results: "Introduzione TARIC.\nCompletamento Teleriscaldamento.\nEfficientamento scuole Dunarobba.\nLED su pubblica illuminazione.\nBonus 300‚Ç¨ adozioni cani."
                    },
                    {
                        id: 'admin', name: 'Amm.ne & Sicurezza', color: 'bg-slate-50 border-slate-200', titleColor: 'text-slate-700', icon: 'üü¶',
                        promises: "Sportello del cittadino e digitalizzazione.\nSicurezza e Polizia locale.\nSupporto al commercio.",
                        results: "Attivazione Sportello del Cittadino.\nDigitalizzazione SUAPE.\nNuovo sito web PNRR.\nContributo 28k‚Ç¨ al commercio.\nRicostituzione Polizia Municipale.\nAcquisizione Ex Cottolengo."
                    }
                ],
                ongoingProjects: [
                    { id: 'agora', title: 'Centro Polifunzionale ‚ÄúAgor√†‚Äù', desc: 'Realizzazione di uno spazio polivalente per eventi, incontri, attivit√† sociali e culturali. Un nuovo luogo di aggregazione per giovani e famiglie.', progress: 65, status: 'Cantiere in corso' }
                ],
                futureGoals: [
                    "Completare la piena fruibilit√† turistica della Grotta Bella.",
                    "Rafforzare i servizi domiciliari per la terza et√†.",
                    "Nuovo piano asfalti per le strade rurali.",
                    "Potenziamento della videosorveglianza nelle frazioni."
                ],
                // DETAILED PROJECTS FOR GRID VIEW (Subset/Detail)
                projects: [
                    { id: 1, title: "Parcheggio Via Levi", category: "opere", year: "2023", stato: "concluso", desc: "Nuova area di sosta e riqualificazione viabilit√†.", imgAfter: "https://images.unsplash.com/photo-1590674899505-1c5c41951f89?q=80&w=800", imgBefore: "https://images.unsplash.com/photo-1533552026196-1c73a6693895?q=80&w=800" },
                    { id: 2, title: "Biblioteca Bettelli", category: "cultura", year: "2022", stato: "concluso", desc: "Riapertura con spazi coworking e nuovi arredi.", imgAfter: "https://images.unsplash.com/photo-1521587760476-6c12a4b040da?q=80&w=800" },
                    { id: 3, title: "Borgo 0-6 Sismano", category: "sociale", year: "2023", stato: "concluso", desc: "Servizio educativo sperimentale per l'infanzia.", imgAfter: "https://images.unsplash.com/photo-1587654780291-39c940483713?q=80&w=800" },
                    { id: 4, title: "Ex Cottolengo", category: "amministrazione", year: "2026", stato: "in_corso", desc: "Acquisizione immobile storico (477k‚Ç¨).", imgAfter: "https://images.unsplash.com/photo-1564501049412-61c2a3083791?q=80&w=800" },
                    { id: 5, title: "Piazza del Teatro", category: "opere", year: "2024", stato: "concluso", desc: "Nuova pavimentazione, fontana e illuminazione.", imgAfter: "https://images.unsplash.com/photo-1570168007204-dfb528c6958f?q=80&w=800" }
                ],
                priorities: [
                    { id: 'p1', title: 'Manutenzione Strade', icon: 'üõ£Ô∏è' },
                    { id: 'p2', title: 'Supporto Giovani', icon: 'üéì' },
                    { id: 'p3', title: 'Turismo Lento', icon: 'üö≤' },
                    { id: 'p4', title: 'Sicurezza', icon: 'üõ°Ô∏è' },
                    { id: 'p5', title: 'Eventi Culturali', icon: 'üé≠' },
                    { id: 'p6', title: 'Energia Green', icon: '‚ö°' }
                ]
            },
            init() {
                const s = localStorage.getItem('avigliano_v8_db');
                if(s) {
                    const parsed = JSON.parse(s);
                    // Merge strategies to ensure new fields exist if migrating from old version
                    this.state = { ...this.state, ...parsed }; 
                    if(!this.state.areas) this.state.areas = this.defaults.areas; // Fallback
                }
                this.renderAll();
                this.setupAnimations();
            },
            save() { localStorage.setItem('avigliano_v8_db', JSON.stringify(this.state)); },
            renderAll() { UI.init(); },
            setupAnimations() {
                gsap.registerPlugin(ScrollTrigger);
                gsap.from("#hero-title", { duration: 1, y: 50, opacity: 0, delay: 0.2 });
                gsap.from("#hero-desc", { duration: 1, y: 30, opacity: 0, delay: 0.4 });
                
                // Animate Area Cards
                gsap.utils.toArray('.area-card').forEach((card, i) => {
                    gsap.from(card, {
                        scrollTrigger: { trigger: card, start: "top 85%" },
                        y: 50, opacity: 0, duration: 0.6, delay: i * 0.1
                    });
                });
            }
        };

        const UI = {
            filter: 'all',
            init() {
                this.applyTheme(Data.state.theme);
                this.renderHero();
                this.renderStats();
                this.renderComparison();
                this.renderOngoing();
                this.renderProjects();
                this.renderFuture();
                this.renderTimeline();
                this.renderPriorities();
                this.renderMap();
            },
            applyTheme(t) { document.body.className = `antialiased font-sans theme-${t} ${document.body.classList.contains('admin-mode') ? 'admin-mode' : ''}`; },
            renderHero() {
                document.getElementById('hero-title').innerHTML = Data.state.texts.heroTitle;
                document.getElementById('hero-desc').innerHTML = Data.state.texts.heroDesc;
                document.getElementById('hero-bg-img').src = Data.state.texts.heroImg;
            },
            renderStats() {
                document.getElementById('stat-total').innerText = 36; // Hardcoded real count from PDF extraction
                document.getElementById('stat-completed').innerText = 32;
                document.getElementById('stat-wip').innerText = 4;
                document.getElementById('stat-money').innerText = "‚Ç¨2M+";
            },
            renderComparison() {
                const c = document.getElementById('areas-container');
                c.innerHTML = '';
                Data.state.areas.forEach(area => {
                    const promisesList = area.promises.split('\n').map(l => `<li>${l}</li>`).join('');
                    const resultsList = area.results.split('\n').map(l => `<li>${l}</li>`).join('');
                    
                    c.innerHTML += `
                    <div class="area-card glass-card p-0 overflow-hidden border-l-4 ${area.color.replace('bg-', 'border-l-')}">
                        <div class="p-6 md:p-8 flex flex-col md:flex-row gap-8">
                            <div class="md:w-1/3 border-b md:border-b-0 md:border-r border-gray-100 pb-6 md:pb-0 md:pr-6">
                                <div class="flex items-center gap-3 mb-4">
                                    <span class="text-2xl">${area.icon}</span>
                                    <h3 class="font-serif font-bold text-2xl ${area.titleColor}">${area.name}</h3>
                                </div>
                                <h4 class="font-bold text-sm uppercase text-gray-400 mb-4 tracking-widest">Cosa avevamo promesso</h4>
                                <ul class="promise-list space-y-3">
                                    ${promisesList}
                                </ul>
                            </div>
                            <div class="md:w-2/3 pt-2 md:pt-0">
                                <h4 class="font-bold text-sm uppercase text-brand-blue mb-4 tracking-widest">Cosa abbiamo fatto</h4>
                                <ul class="check-list space-y-3 text-brand-dark font-medium">
                                    ${resultsList}
                                </ul>
                            </div>
                        </div>
                    </div>`;
                });
            },
            renderOngoing() {
                const c = document.getElementById('ongoing-container');
                c.innerHTML = '';
                Data.state.ongoingProjects.forEach(p => {
                    c.innerHTML += `
                    <div>
                        <p class="text-gray-300 font-sans mb-6 text-lg leading-relaxed">${p.desc}</p>
                        <div class="w-full bg-gray-700 rounded-full h-4 mb-2">
                            <div class="bg-brand-accent h-4 rounded-full transition-all duration-1000" style="width: ${p.progress}%"></div>
                        </div>
                        <div class="flex justify-between text-xs font-bold uppercase tracking-wider text-gray-400">
                            <span>Avvio Lavori</span>
                            <span>Completamento</span>
                        </div>
                    </div>`;
                });
            },
            renderFuture() {
                const c = document.getElementById('future-container');
                c.innerHTML = '';
                Data.state.futureGoals.forEach(g => {
                    c.innerHTML += `
                    <div class="bg-white p-6 rounded-theme shadow-sm border border-gray-100 flex items-start gap-4">
                        <div class="mt-1 text-brand-blue">‚ûî</div>
                        <p class="font-medium text-gray-700">${g}</p>
                    </div>`;
                });
            },
            renderProjects() {
                const c = document.getElementById('view-container'); c.innerHTML = '';
                const cats = { 'sociale': 'Sociale', 'cultura': 'Cultura', 'opere': 'Opere', 'ambiente': 'Ambiente', 'amministrazione': 'Amm.ne' };
                
                const cf = document.getElementById('category-filters');
                cf.innerHTML = `<button onclick="UI.filter='all'; UI.renderProjects()" class="px-4 py-1.5 text-xs font-bold rounded-full transition-colors ${this.filter==='all'?'bg-brand-dark text-white':'bg-gray-100 hover:bg-gray-200 text-gray-600'}">TUTTI</button>` + 
                Object.keys(cats).map(k => `<button onclick="UI.filter='${k}'; UI.renderProjects()" class="px-4 py-1.5 text-xs font-bold rounded-full transition-colors ${this.filter===k?'bg-brand-blue text-white':'bg-gray-100 hover:bg-gray-200 text-gray-600'}">${cats[k].toUpperCase()}</button>`).join('');

                const q = document.getElementById('search-input').value.toLowerCase();
                const list = Data.state.projects.filter(p => (this.filter==='all' || p.category === this.filter) && p.title.toLowerCase().includes(q));
                
                c.className = "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8";

                list.forEach(p => {
                    const el = document.createElement('div');
                    el.className = "glass-card overflow-hidden flex flex-col h-full bg-white group";
                    el.innerHTML = `
                        <div class="h-56 bg-gray-200 relative overflow-hidden">
                            ${p.imgBefore ? `
                            <div class="comparison-wrapper" onmousemove="UI.slider(event, this)" ontouchmove="UI.slider(event, this)">
                                <div class="comparison-after" style="background-image: url('${p.imgAfter}')"></div>
                                <div class="comparison-before" style="background-image: url('${p.imgBefore}')"></div>
                                <div class="comparison-handle text-gray-500 text-xs font-bold">‚Üî</div>
                                <span class="absolute bottom-2 left-2 text-[10px] bg-black/50 text-white px-1 rounded z-20">PRIMA</span>
                                <span class="absolute bottom-2 right-2 text-[10px] bg-brand-blue/80 text-white px-1 rounded z-0">DOPO</span>
                            </div>` : `<img src="${p.imgAfter}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">`}
                        </div>
                        <div class="p-6 flex-1 flex flex-col">
                            <div class="flex justify-between mb-3 items-center">
                                <span class="text-[10px] font-bold uppercase px-2 py-1 rounded bg-slate-100 text-slate-600">${cats[p.category]}</span>
                                <span class="text-xs font-bold ${p.stato==='concluso'?'text-green-600':'text-amber-600'}">${p.stato === 'concluso' ? '‚úì Concluso' : 'üöß In Corso'}</span>
                            </div>
                            <h3 class="font-bold text-xl text-brand-dark mb-2 font-serif">${p.title}</h3>
                            <p class="text-sm text-gray-600 line-clamp-3 mb-4 font-sans leading-relaxed">${p.desc}</p>
                        </div>
                    `;
                    c.appendChild(el);
                });
            },
            slider(e, el) {
                const rect = el.getBoundingClientRect();
                const x = (e.touches?e.touches[0].clientX:e.clientX) - rect.left;
                const p = Math.max(0,Math.min(100, (x/rect.width)*100));
                el.querySelector('.comparison-before').style.width = p + '%';
                el.querySelector('.comparison-handle').style.left = p + '%';
            },
            renderTimeline() {
                const c = document.getElementById('timeline-container'); c.innerHTML = '';
                Data.state.timeline.forEach((step, idx) => {
                    c.innerHTML += `
                    <div class="bg-white p-6 rounded-theme shadow-sm border border-gray-100 relative ${idx===1?'ring-2 ring-brand-blue':''}">
                        <div class="w-12 h-12 ${idx===1?'bg-brand-blue text-white':'bg-white text-brand-dark border-2 border-gray-200'} rounded-full flex items-center justify-center font-bold mx-auto mb-4 text-xl shadow relative md:-top-12 z-20">${step.step}</div>
                        <h4 class="font-bold text-xl font-serif text-brand-dark">${step.title}</h4>
                        <p class="text-sm text-brand-blue font-bold mb-3">${step.year}</p>
                        <p class="text-sm text-gray-500 leading-relaxed">${step.desc}</p>
                    </div>`;
                });
            },
            renderPriorities() {
                const c = document.getElementById('priority-grid'); c.innerHTML = '';
                Data.state.priorities.forEach(p => {
                    const voted = localStorage.getItem(`vote_${p.id}`);
                    const div = document.createElement('div');
                    div.className = `bg-white/10 border border-white/20 p-4 rounded-theme hover:bg-white/20 transition cursor-pointer flex items-center gap-4 text-left ${voted ? 'ring-2 ring-brand-accent bg-white/20' : ''}`;
                    div.onclick = (e) => { 
                        if(document.body.classList.contains('admin-mode')) { e.stopPropagation(); Admin.handleClick('priorities'); return; }
                        localStorage.setItem(`vote_${p.id}`, voted ? '' : 'true'); 
                        this.renderPriorities(); 
                        this.toast(voted ? 'Preferenza rimossa' : 'Preferenza registrata');
                    };
                    div.innerHTML = `<div class="text-2xl">${p.icon}</div><div><h3 class="font-bold text-white font-serif">${p.title}</h3>${voted ? '<span class="text-brand-accent text-[10px] font-bold uppercase">‚úÖ Votato</span>' : ''}</div>`;
                    c.appendChild(div);
                });
            },
            renderMap() {
                const c = document.getElementById('map-markers-container'); c.innerHTML = '';
                const coords = [{t:30,l:40},{t:50,l:50},{t:40,l:60},{t:60,l:30},{t:25,l:55},{t:45,l:45}]; // Simulated positions
                Data.state.projects.forEach((p, i) => {
                    const pos = coords[i % coords.length];
                    const m = document.createElement('div'); m.className = 'map-marker';
                    m.style.top = (pos.t + (Math.random()*10-5))+'%'; 
                    m.style.left = (pos.l + (Math.random()*10-5))+'%';
                    m.style.borderColor = p.category === 'opere' ? '#fbbf24' : (p.category === 'sociale' ? '#3b82f6' : '#10b981');
                    m.innerHTML = `<div class="map-popup">${p.title}</div>`;
                    c.appendChild(m);
                });
            },
            toast(m) {
                const t = document.createElement('div'); t.className = 'toast'; t.innerText = m;
                document.getElementById('toast-container').appendChild(t); setTimeout(()=>t.remove(), 3000);
            }
        };

        const Admin = {
            toggle() { document.getElementById('admin-dashboard').classList.toggle('translate-x-full'); },
            login() { 
                if(document.getElementById('admin-password').value === 'admin') {
                    document.getElementById('login-modal').classList.add('hidden');
                    document.body.classList.add('admin-mode');
                    this.toggle();
                } else { alert('Password errata'); }
            },
            handleClick(sectionId) {
                if(!document.body.classList.contains('admin-mode')) return;
                this.loadSectionEditor(sectionId);
                const sb = document.getElementById('admin-dashboard');
                if(sb.classList.contains('translate-x-full')) sb.classList.remove('translate-x-full');
            },
            loadSectionEditor(type) {
                document.getElementById('admin-default-view').classList.add('hidden');
                const f = document.getElementById('admin-dynamic-form');
                f.classList.remove('hidden');
                
                let html = `<div class="mb-4 pb-2 border-b flex justify-between items-center"><h3 class="font-bold text-sm uppercase text-brand-blue">Modifica ${type}</h3> <button onclick="Admin.closeEditor()" class="text-xs text-red-500 font-bold hover:underline">CHIUDI</button></div>`;

                if(type === 'hero') {
                    html += `
                    <label class="text-xs font-bold text-gray-500">Titolo Hero</label><textarea id="ed-hero-title" class="w-full border p-2 mb-2 rounded font-serif text-sm">${Data.state.texts.heroTitle}</textarea>
                    <label class="text-xs font-bold text-gray-500">Sottotitolo</label><textarea id="ed-hero-desc" class="w-full border p-2 mb-2 rounded text-sm">${Data.state.texts.heroDesc}</textarea>
                    <button onclick="Admin.saveHero()" class="w-full bg-brand-blue text-white py-2 rounded font-bold text-sm shadow mt-2">Salva Modifiche</button>`;
                } else if(type === 'design') {
                    html += `
                    <p class="text-xs mb-3 text-gray-500">Seleziona lo stile grafico globale:</p>
                    <button onclick="Admin.setTheme('classic')" class="w-full p-3 border rounded mb-2 text-left hover:bg-blue-50 transition-colors ${Data.state.theme==='classic'?'border-brand-blue bg-blue-50 ring-1 ring-brand-blue':''}">üèõÔ∏è <b>Classico</b><br><span class="text-xs text-gray-500">Serif, Blu/Oro, Istituzionale</span></button>
                    <button onclick="Admin.setTheme('modern')" class="w-full p-3 border rounded mb-2 text-left hover:bg-blue-50 transition-colors ${Data.state.theme==='modern'?'border-brand-blue bg-blue-50 ring-1 ring-brand-blue':''}">üî∑ <b>Moderno</b><br><span class="text-xs text-gray-500">Inter, Minimal, Pulito</span></button>
                    <button onclick="Admin.setTheme('energetic')" class="w-full p-3 border rounded mb-2 text-left hover:bg-blue-50 transition-colors ${Data.state.theme==='energetic'?'border-brand-blue bg-blue-50 ring-1 ring-brand-blue':''}">‚ö° <b>Energetico</b><br><span class="text-xs text-gray-500">Bold, Contrasto alto</span></button>`;
                } else if(type === 'areas') {
                    html += `<p class="text-xs mb-2 text-gray-500">Modifica testi confronto (Promesso vs Fatto):</p>
                    <select id="ed-area-select" class="w-full border p-2 mb-4 rounded text-sm font-bold" onchange="Admin.loadAreaFields(this.value)">
                        ${Data.state.areas.map((a,i) => `<option value="${i}">${a.name}</option>`).join('')}
                    </select>
                    <div id="ed-area-fields"></div>
                    <button onclick="Admin.saveArea()" class="w-full bg-brand-blue text-white py-2 rounded font-bold text-sm shadow mt-4">Salva Area</button>`;
                    setTimeout(() => Admin.loadAreaFields(0), 10);
                } else {
                    html += `<p class="text-sm text-gray-500 italic">Editor specifico non disponibile. Usa il backup JSON per modifiche avanzate.</p>`;
                }
                f.innerHTML = html;
            },
            loadAreaFields(idx) {
                const area = Data.state.areas[idx];
                const div = document.getElementById('ed-area-fields');
                div.innerHTML = `
                    <input type="hidden" id="ed-area-idx" value="${idx}">
                    <label class="text-xs font-bold text-gray-500">Titolo Area</label>
                    <input type="text" id="ed-area-name" class="w-full border p-2 mb-2 rounded text-sm" value="${area.name}">
                    <label class="text-xs font-bold text-gray-500">Promesse (una per riga)</label>
                    <textarea id="ed-area-prom" class="w-full border p-2 mb-2 rounded text-sm h-32">${area.promises}</textarea>
                    <label class="text-xs font-bold text-gray-500">Risultati (uno per riga)</label>
                    <textarea id="ed-area-res" class="w-full border p-2 mb-2 rounded text-sm h-32">${area.results}</textarea>
                `;
            },
            saveArea() {
                const idx = document.getElementById('ed-area-idx').value;
                Data.state.areas[idx].name = document.getElementById('ed-area-name').value;
                Data.state.areas[idx].promises = document.getElementById('ed-area-prom').value;
                Data.state.areas[idx].results = document.getElementById('ed-area-res').value;
                Data.save(); UI.renderComparison(); UI.toast('Area aggiornata');
            },
            closeEditor() {
                document.getElementById('admin-dynamic-form').classList.add('hidden');
                document.getElementById('admin-default-view').classList.remove('hidden');
            },
            saveHero() {
                Data.state.texts.heroTitle = document.getElementById('ed-hero-title').value;
                Data.state.texts.heroDesc = document.getElementById('ed-hero-desc').value;
                Data.save(); UI.renderHero(); UI.toast('Hero aggiornata!');
            },
            setTheme(t) {
                Data.state.theme = t;
                Data.save(); UI.applyTheme(t); this.loadSectionEditor('design'); UI.toast('Tema cambiato: '+t);
            },
            exportData() {
                const a = document.createElement('a'); a.href = 'data:text/json;charset=utf-8,'+encodeURIComponent(JSON.stringify(Data.state)); a.download = 'avigliano_backup.json'; a.click();
            },
            resetData() { if(confirm('Sei sicuro? Questo canceller√† tutte le modifiche.')) { localStorage.removeItem('avigliano_v8_db'); location.reload(); } }
        };

        window.addEventListener('DOMContentLoaded', () => Data.init());
    </script>
</body>
</html>